<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>縦書き 紙芝居エディタ（ラスタ＆レイヤー付き）</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <!-- ===== 上部ツールバー ===== -->
  <header>
    <div class="toolbar">
      <div class="row">
        <!-- 画面上には出さないが内部的に使うエディタ -->
        <textarea id="editor" style="display:none;"></textarea>

        <label class="font-label">
          文字サイズ
          <input id="fontSize" type="number" min="12" max="200" value="64" />
          <span>px</span>
        </label>

        <button id="addOne">+ 1ページ追加</button>
        <button id="duplicate">ページを複製</button>
        <button id="delete">ページを削除</button>
        <button id="prev">◀ 前へ</button>
        <button id="next">次へ ▶</button>
        <button id="rasterize">ラスタライズ</button>
        <button id="backToText">テキストに戻す</button>
        <button id="save">保存</button>
        <button id="load">読込</button>
        <button id="export">書き出し</button>
        <button id="import">読み込み</button>
        <span id="counter" class="page-counter"></span>
      </div>
    </div>
  </header>

  <!-- JSONインポート用（非表示） -->
  <input id="importFile" type="file" accept="application/json" style="display:none" />
  <!-- 画像インポート用（非表示） -->
  <input id="imageFile" type="file" accept="image/*" style="display:none" />

  <!-- ===== メインステージ ===== -->
  <main>
    <div class="stage">
      <div id="output" class="text">文字を視る</div>
      <div class="badge" id="badge">01</div>
      <!-- char-layer は JS 側で追加される -->
    </div>
  </main>

  <!-- ===== サムネイル（ページ一覧） ===== -->
  <div class="railWrap">
    <div id="rail" class="rail" aria-label="ページ一覧"></div>
  </div>

  <!-- ===== オブジェクトパネル（左） ===== -->
  <aside id="objectPanel" class="object-panel">
    <div class="panel-drag-handle">OBJECTS</div>

    <!-- 図形＆テキストツール -->
    <div class="object-panel-section">
      <div class="object-panel-title">TOOLS</div>
      <div class="object-tool-row">
        <button id="shapeCircleFill" class="object-tool-btn" title="塗り丸">●</button>
        <button id="shapeCircleRing" class="object-tool-btn" title="線だけの丸">○</button>
        <button id="shapeTriangle" class="object-tool-btn" title="三角">▲</button>
        <button id="shapeSquare" class="object-tool-btn" title="正方形">■</button>
        <button id="shapeFullRect" class="object-tool-btn" title="全面長方形">▭</button>
      </div>
      <div class="object-tool-row">
        <button id="toolTextBtn" class="object-tool-btn" title="テキスト">T</button>
        <input
          id="toolTextInput"
          type="text"
          placeholder="テキスト"
          class="object-text-input"
        />
      </div>
      <p class="object-hint">
        Tを押すとテキストボックスを追加できます。<br>
        Sキーでサイズ編集モードのON/OFF。
      </p>
    </div>

    <!-- カラー -->
    <div class="object-panel-section">
      <div class="object-panel-title">COLOR</div>
      <div class="color-palette">
        <button class="color-swatch active" data-color="#111111" style="background:#111111;"></button>
        <button class="color-swatch" data-color="#e53935" style="background:#e53935;"></button>
        <button class="color-swatch" data-color="#1565c0" style="background:#1565c0;"></button>
        <button class="color-swatch" data-color="#fbc02d" style="background:#fbc02d;"></button>
        <button class="color-swatch" data-color="#8e24aa" style="background:#8e24aa;"></button>
        <button class="color-swatch" data-color="#00897b" style="background:#00897b;"></button>
      </div>
      <div class="color-custom-row">
        <span>Custom</span>
        <input id="customColor" type="color" value="#111111" />
      </div>
    </div>

    <!-- SNAP（スナップ機能） -->
    <div class="object-panel-section">
      <div class="object-panel-title">SNAP</div>
      <label class="snap-toggle">
        <input type="checkbox" id="snapCenterToggle" />
        <span>中央スナップ</span>
      </label>
      <p class="snap-hint">
        ON のとき、キャンバス中央付近や他のオブジェクトの<br>
        中心付近で離すと、ぴったり揃います。
      </p>
    </div>
  </aside>

  <!-- ===== レイヤーパネル（右上） ===== -->
  <aside id="panelLayers" class="layers-panel">
    <div class="panel-drag-handle">LAYERS</div>
    <ul id="layerList" class="layer-list"></ul>
  </aside>

  <!-- ===== コードパネル（右下） ===== -->
  <aside id="panelCode" class="code-panel">
    <div class="panel-drag-handle">CANVAS CODE</div>
    <textarea id="canvasCode" class="code-textarea" readonly></textarea>
    <button id="copyCode" class="copy-code-btn">コードをコピー</button>
  </aside>

  <!-- ===== フッター ===== -->
  <footer>
    サムネイルクリックでページジャンプ / キャンバスをクリックして Enter でテキスト編集開始 /
    ←→ でページ送り / <strong>Fでページだけフルスクリーン</strong> /
    <strong>Sでサイズ編集モード</strong> /
    <strong>Ctrl+Z / Ctrl+Shift+Z = Undo / Redo</strong>
  </footer>

  <script src="js/app.js"></script>
</body>
</html>
